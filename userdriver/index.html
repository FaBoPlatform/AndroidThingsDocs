



<!DOCTYPE html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="クリップボードへコピー">
      
        <meta name="lang:clipboard.copied" content="コピーしました">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="何も見つかりませんでした">
      
        <meta name="lang:search.result.one" content="1件見つかりました">
      
        <meta name="lang:search.result.other" content="#件見つかりました">
      
        <meta name="lang:search.tokenizer" content="[\s\-　、。，．]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.1.0">
    
    
      
        <title>UserDriver - FaBo Android Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.11e41852.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.20ef595d.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#userdriver" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="FaBo Android Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                FaBo Android Docs
              </span>
              <span class="md-header-nav__topic">
                UserDriver
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            検索キーワードを入力してください
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="FaBo Android Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    FaBo Android Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="FaBo Keras Docs" class="md-nav__link">
      FaBo Keras Docs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../201_3axis/" title="201 3Axis" class="md-nav__link">
      201 3Axis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../203_color/" title="203 Color" class="md-nav__link">
      203 Color
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../206_uv/" title="206 UV" class="md-nav__link">
      206 UV
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../217_ambient/" title="201 3Axis" class="md-nav__link">
      201 3Axis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3axis/" title="3Axis" class="md-nav__link">
      3Axis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3axisui/" title="3Axis" class="md-nav__link">
      3Axis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SUMMARY/" title="SUMMARY" class="md-nav__link">
      SUMMARY
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../button/" title="Button" class="md-nav__link">
      Button
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../color/" title="Color" class="md-nav__link">
      Color
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../colorui/" title="Color" class="md-nav__link">
      Color
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../colorui2/" title="Color" class="md-nav__link">
      Color
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intent00/" title="Intent" class="md-nav__link">
      Intent
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intent01/" title="暗黙的Intent" class="md-nav__link">
      暗黙的Intent
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intent03/" title="Intentでカメラを操作" class="md-nav__link">
      Intentでカメラを操作
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intent04/" title="Intentでビデオを操作" class="md-nav__link">
      Intentでビデオを操作
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intent05/" title="Intentを作成する" class="md-nav__link">
      Intentを作成する
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../led/" title="LED" class="md-nav__link">
      LED
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../lib/" title="FaBo libtary" class="md-nav__link">
      FaBo libtary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../peripheral/" title="Peripheral" class="md-nav__link">
      Peripheral
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../robotarm/" title="RobotARM" class="md-nav__link">
      RobotARM
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../servo/" title="Servo" class="md-nav__link">
      Servo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../uart/" title="UART" class="md-nav__link">
      UART
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui01/" title="FindViewById" class="md-nav__link">
      FindViewById
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui02/" title="XMLでのLayout" class="md-nav__link">
      XMLでのLayout
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui03/" title="XMLでのLayout2" class="md-nav__link">
      XMLでのLayout2
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui04/" title="Button" class="md-nav__link">
      Button
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui05/" title="TextView" class="md-nav__link">
      TextView
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui06/" title="EditText" class="md-nav__link">
      EditText
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ui07/" title="電卓の作成" class="md-nav__link">
      電卓の作成
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../update/" title="Android Things Console" class="md-nav__link">
      Android Things Console
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="UserDriver" class="md-nav__link md-nav__link--active">
      UserDriver
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../webview01/" title="WebView表示" class="md-nav__link">
      WebView表示
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="userdriver">UserDriver</h1>
<p>自作したDriverは、UserDriverとしてアプリに組み込む事が可能です。</p>
<p>Adx345.java</p>
<p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>package</span> <span class=nn>com.gclue.adx345</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>com.google.android.things.pio.I2cDevice</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>com.google.android.things.pio.PeripheralManager</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Adx345</span> <span class=kd>implements</span> <span class=n>AutoCloseable</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>TAG</span> <span class=o>=</span> <span class=n>Adx345</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>();</span>

    <span class=cm>/**</span>
<span class=cm>     * I2C slave address of the Adx345.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>I2C_ADDRESS</span> <span class=o>=</span> <span class=mh>0x53</span><span class=o>;</span>

    <span class=cm>/**</span>
<span class=cm>     * Sampling rate of the measurement.</span>
<span class=cm>     */</span>
    <span class=cm>/** Who_am_i register */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_DEVID_REG</span> <span class=o>=</span> <span class=mh>0x00</span><span class=o>;</span>
    <span class=cm>/** name of adx345 */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_DEVICE_NAME</span> <span class=o>=</span> <span class=o>(</span><span class=kt>byte</span><span class=o>)</span> <span class=mh>0xE5</span><span class=o>;</span>
    <span class=cm>/** Data Format Control */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_DATA_FORMAT_REG</span> <span class=o>=</span> <span class=mh>0x31</span><span class=o>;</span>
    <span class=cm>/** Power-saving features control */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_POWER_CTL_REG</span> <span class=o>=</span> <span class=mh>0x2D</span><span class=o>;</span>
    <span class=cm>/** Power-saving features control */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_3AIXS</span> <span class=o>=</span> <span class=mh>0x32</span><span class=o>;</span>
    <span class=cm>/** SELF Test ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_SELF_TEST_ON</span> <span class=o>=</span> <span class=o>(</span><span class=kt>byte</span><span class=o>)</span> <span class=mb>0b10000000</span><span class=o>;</span>
    <span class=cm>/** SELF Test OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_SELF_TEST_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** SELF SPI ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_SPI_ON</span> <span class=o>=</span> <span class=mb>0b01000000</span><span class=o>;</span>
    <span class=cm>/** SELF SPI OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_SPI_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** INT_INVERT ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_INT_INVERT_ON</span> <span class=o>=</span> <span class=mb>0b00100000</span><span class=o>;</span>
    <span class=cm>/** INT_INVERT OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_INT_INVERT_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** FULL_RES ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_FULL_RES_ON</span> <span class=o>=</span> <span class=mb>0b00001000</span><span class=o>;</span>
    <span class=cm>/** FULL_RES OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_FULL_RES_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** JUSTIFY ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_JUSTIFY_ON</span> <span class=o>=</span> <span class=mb>0b00000100</span><span class=o>;</span>
    <span class=cm>/** JUSTIFY OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_JUSTIFY_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** RANGE 2G */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_RANGE_2G</span> <span class=o>=</span> <span class=mb>0b00</span><span class=o>;</span>
    <span class=cm>/** RANGE 4G */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_RANGE_4G</span> <span class=o>=</span> <span class=mb>0b01</span><span class=o>;</span>
    <span class=cm>/** RANGE 8G */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_RANGE_8G</span> <span class=o>=</span> <span class=mb>0b10</span><span class=o>;</span>
    <span class=cm>/** RANGE 16G */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_RANGE_16G</span> <span class=o>=</span> <span class=mb>0b11</span><span class=o>;</span>
    <span class=cm>/** AUTO SLEEP ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_AUTO_SLEEP_ON</span> <span class=o>=</span> <span class=mb>0b00010000</span><span class=o>;</span>
    <span class=cm>/** AUTO SLEEP OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_AUTO_SLEEP_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** AUTO MEASURE ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_MEASURE_ON</span> <span class=o>=</span> <span class=mb>0b00001000</span><span class=o>;</span>
    <span class=cm>/** AUTO MEASURE OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_MEASURE_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** SLEEP ON */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_SLEEP_ON</span> <span class=o>=</span> <span class=mb>0b00000100</span><span class=o>;</span>
    <span class=cm>/** SLEEP OFF */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_SLEEP_OFF</span> <span class=o>=</span> <span class=mb>0b00000000</span><span class=o>;</span>
    <span class=cm>/** WAKEUP 8Hz */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_WAKEUP_8HZ</span> <span class=o>=</span> <span class=mb>0b00</span><span class=o>;</span>
    <span class=cm>/** WAKEUP 4Hz */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_WAKEUP_4HZ</span> <span class=o>=</span> <span class=mb>0b01</span><span class=o>;</span>
    <span class=cm>/** WAKEUP 2Hz */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_WAKEUP_2HZ</span> <span class=o>=</span> <span class=mb>0b10</span><span class=o>;</span>
    <span class=cm>/** WAKEUP 1Hz */</span>
    <span class=kd>private</span> <span class=kt>byte</span> <span class=n>ADXL345_WAKEUP_1HZ</span> <span class=o>=</span> <span class=mb>0b11</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>I2cDevice</span> <span class=n>mDevice</span><span class=o>;</span>

    <span class=cm>/**</span>
<span class=cm>     * Create a new Adx345 driver connected to the given I2C bus.</span>
<span class=cm>     * @param bus</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>Adx345</span><span class=o>(</span><span class=n>String</span> <span class=n>bus</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>PeripheralManager</span> <span class=n>pioService</span> <span class=o>=</span> <span class=n>PeripheralManager</span><span class=o>.</span><span class=na>getInstance</span><span class=o>();</span>
        <span class=n>I2cDevice</span> <span class=n>device</span> <span class=o>=</span> <span class=n>pioService</span><span class=o>.</span><span class=na>openI2cDevice</span><span class=o>(</span><span class=n>bus</span><span class=o>,</span> <span class=n>I2C_ADDRESS</span><span class=o>);</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>connect</span><span class=o>(</span><span class=n>device</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span><span class=o>|</span><span class=n>RuntimeException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>close</span><span class=o>();</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span><span class=o>|</span><span class=n>RuntimeException</span> <span class=n>ignored</span><span class=o>)</span> <span class=o>{</span>
            <span class=o>}</span>
            <span class=k>throw</span> <span class=n>e</span><span class=o>;</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Create a new Adx345 driver connected to the given I2C device.</span>
<span class=cm>     * @param device</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     */</span>
    <span class=cm>/*package*/</span> <span class=n>Adx345</span><span class=o>(</span><span class=n>I2cDevice</span> <span class=n>device</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>connect</span><span class=o>(</span><span class=n>device</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>connect</span><span class=o>(</span><span class=n>I2cDevice</span> <span class=n>device</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mDevice</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&quot;device already connected&quot;</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=n>mDevice</span> <span class=o>=</span> <span class=n>device</span><span class=o>;</span>
    <span class=o>}</span>


    <span class=cm>/**</span>
<span class=cm>     * Close the driver and the underlying device.</span>
<span class=cm>     */</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>close</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mDevice</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>mDevice</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
            <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
                <span class=n>mDevice</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Who am I .</span>
<span class=cm>     * @return find or not find.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>whoAmI</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=kt>byte</span> <span class=n>value</span> <span class=o>=</span> <span class=n>mDevice</span><span class=o>.</span><span class=na>readRegByte</span><span class=o>(</span><span class=n>ADXL345_DEVID_REG</span><span class=o>);</span>
            <span class=k>if</span><span class=o>((</span><span class=n>value</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=o>)</span> <span class=o>==</span> <span class=n>ADXL345_DEVICE_NAME</span><span class=o>)</span> <span class=o>{</span>
                <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
            <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Set configure.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setConfigure</span><span class=o>()</span> <span class=o>{</span>
        <span class=kt>byte</span> <span class=n>conf</span> <span class=o>=</span> <span class=n>ADXL345_SELF_TEST_OFF</span><span class=o>;</span>
        <span class=n>conf</span> <span class=o>|=</span> <span class=n>ADXL345_SPI_OFF</span><span class=o>;</span>
        <span class=n>conf</span> <span class=o>|=</span> <span class=n>ADXL345_INT_INVERT_OFF</span><span class=o>;</span>
        <span class=n>conf</span> <span class=o>|=</span> <span class=n>ADXL345_FULL_RES_OFF</span><span class=o>;</span>
        <span class=n>conf</span> <span class=o>|=</span> <span class=n>ADXL345_JUSTIFY_OFF</span><span class=o>;</span>
        <span class=n>conf</span> <span class=o>|=</span> <span class=n>ADXL345_RANGE_16G</span><span class=o>;</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>mDevice</span><span class=o>.</span><span class=na>writeRegByte</span><span class=o>(</span><span class=n>ADXL345_DATA_FORMAT_REG</span><span class=o>,</span> <span class=n>conf</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Power on.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>powerOn</span><span class=o>()</span> <span class=o>{</span>
        <span class=kt>byte</span> <span class=n>power</span> <span class=o>=</span> <span class=n>ADXL345_AUTO_SLEEP_OFF</span><span class=o>;</span>
        <span class=n>power</span> <span class=o>|=</span> <span class=n>ADXL345_MEASURE_ON</span><span class=o>;</span>
        <span class=n>power</span> <span class=o>|=</span> <span class=n>ADXL345_SLEEP_OFF</span><span class=o>;</span>
        <span class=n>power</span> <span class=o>|=</span> <span class=n>ADXL345_WAKEUP_8HZ</span><span class=o>;</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>mDevice</span><span class=o>.</span><span class=na>writeRegByte</span><span class=o>(</span><span class=n>ADXL345_POWER_CTL_REG</span><span class=o>,</span> <span class=n>power</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Read an accelerometer sample.</span>
<span class=cm>     * @return acceleration over xyz axis in G.</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     * @throws IllegalStateException</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kt>float</span><span class=o>[]</span> <span class=nf>readSample</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>IllegalStateException</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mDevice</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&quot;device not connected&quot;</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=kt>int</span> <span class=n>length</span> <span class=o>=</span> <span class=mi>6</span><span class=o>;</span>
        <span class=kt>byte</span> <span class=n>axis_buff</span><span class=o>[]</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=n>length</span><span class=o>];</span>
        <span class=n>mDevice</span><span class=o>.</span><span class=na>readRegBuffer</span><span class=o>(</span><span class=n>ADXL345_3AIXS</span><span class=o>,</span> <span class=n>axis_buff</span><span class=o>,</span> <span class=n>axis_buff</span><span class=o>.</span><span class=na>length</span><span class=o>);</span>
        <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=o>(((</span><span class=kt>int</span><span class=o>)</span><span class=n>axis_buff</span><span class=o>[</span><span class=mi>1</span><span class=o>])</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=o>)</span> <span class=o>|</span> <span class=n>axis_buff</span><span class=o>[</span><span class=mi>0</span><span class=o>];</span>
        <span class=kt>int</span> <span class=n>y</span> <span class=o>=</span> <span class=o>(((</span><span class=kt>int</span><span class=o>)</span><span class=n>axis_buff</span><span class=o>[</span><span class=mi>3</span><span class=o>])</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=o>)</span> <span class=o>|</span> <span class=n>axis_buff</span><span class=o>[</span><span class=mi>2</span><span class=o>];</span>
        <span class=kt>int</span> <span class=n>z</span> <span class=o>=</span> <span class=o>(((</span><span class=kt>int</span><span class=o>)</span><span class=n>axis_buff</span><span class=o>[</span><span class=mi>5</span><span class=o>])</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=o>)</span> <span class=o>|</span> <span class=n>axis_buff</span><span class=o>[</span><span class=mi>4</span><span class=o>];</span>
        <span class=k>return</span> <span class=k>new</span> <span class=kt>float</span><span class=o>[]{</span>
                <span class=n>x</span><span class=o>,</span> <span class=n>y</span><span class=o>,</span> <span class=n>z</span>
        <span class=o>};</span>
    <span class=o>}</span>



<span class=o>}</span>
</pre></div></td></tr></table></p>
<p>Adx345AccelerometerDriver.java</p>
<p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>package</span> <span class=nn>com.gclue.adx345</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>android.hardware.Sensor</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.hardware.SensorManager</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>com.google.android.things.userdriver.UserDriverManager</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>com.google.android.things.userdriver.sensor.UserSensor</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>com.google.android.things.userdriver.sensor.UserSensorDriver</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>com.google.android.things.userdriver.sensor.UserSensorReading</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.UUID</span><span class=o>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Adx345AccelerometerDriver</span> <span class=kd>implements</span> <span class=n>AutoCloseable</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>TAG</span> <span class=o>=</span> <span class=n>Adx345AccelerometerDriver</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>();</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DRIVER_NAME</span> <span class=o>=</span> <span class=s>&quot;FaBoAccelerometer&quot;</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DRIVER_VENDOR</span> <span class=o>=</span> <span class=s>&quot;GClue&quot;</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>DRIVER_VERSION</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>Adx345</span> <span class=n>mDevice</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>UserSensor</span> <span class=n>mUserSensor</span><span class=o>;</span>

    <span class=cm>/**</span>
<span class=cm>     * Create a new framework accelerometer driver connected to the given I2C bus.</span>
<span class=cm>     * The driver emits {@link android.hardware.Sensor} with acceleration data when registered.</span>
<span class=cm>     * @param bus</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     * @see #register()</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=nf>Adx345AccelerometerDriver</span><span class=o>(</span><span class=n>String</span> <span class=n>bus</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>mDevice</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Adx345</span><span class=o>(</span><span class=n>bus</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Close the driver and the underlying device.</span>
<span class=cm>     * @throws IOException</span>
<span class=cm>     */</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>close</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>unregister</span><span class=o>();</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mDevice</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>mDevice</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
            <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
                <span class=n>mDevice</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Register the driver in the framework.</span>
<span class=cm>     * @see #unregister()</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>register</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mDevice</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&quot;cannot registered closed driver&quot;</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mUserSensor</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>mUserSensor</span> <span class=o>=</span> <span class=n>build</span><span class=o>(</span><span class=n>mDevice</span><span class=o>);</span>
            <span class=n>UserDriverManager</span><span class=o>.</span><span class=na>getInstance</span><span class=o>().</span><span class=na>registerSensor</span><span class=o>(</span><span class=n>mUserSensor</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/**</span>
<span class=cm>     * Unregister the driver from the framework.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>unregister</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mUserSensor</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>UserDriverManager</span><span class=o>.</span><span class=na>getInstance</span><span class=o>().</span><span class=na>unregisterSensor</span><span class=o>(</span><span class=n>mUserSensor</span><span class=o>);</span>
            <span class=n>mUserSensor</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=kd>static</span> <span class=n>UserSensor</span> <span class=nf>build</span><span class=o>(</span><span class=kd>final</span> <span class=n>Adx345</span> <span class=n>adx345</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>UserSensor</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
                <span class=o>.</span><span class=na>setType</span><span class=o>(</span><span class=n>Sensor</span><span class=o>.</span><span class=na>TYPE_ACCELEROMETER</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>DRIVER_NAME</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setVendor</span><span class=o>(</span><span class=n>DRIVER_VENDOR</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setVersion</span><span class=o>(</span><span class=n>DRIVER_VERSION</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setUuid</span><span class=o>(</span><span class=n>UUID</span><span class=o>.</span><span class=na>randomUUID</span><span class=o>())</span>
                <span class=o>.</span><span class=na>setDriver</span><span class=o>(</span><span class=k>new</span> <span class=n>UserSensorDriver</span><span class=o>()</span> <span class=o>{</span>
                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=n>UserSensorReading</span> <span class=nf>read</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
                        <span class=kt>float</span><span class=o>[]</span> <span class=n>sample</span> <span class=o>=</span> <span class=n>adx345</span><span class=o>.</span><span class=na>readSample</span><span class=o>();</span>
                        <span class=k>return</span> <span class=k>new</span> <span class=n>UserSensorReading</span><span class=o>(</span><span class=n>sample</span><span class=o>);</span>
                    <span class=o>}</span>

                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setEnabled</span><span class=o>(</span><span class=kt>boolean</span> <span class=n>enabled</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
                        <span class=k>if</span> <span class=o>(</span><span class=n>enabled</span><span class=o>)</span> <span class=o>{</span>
                            <span class=n>adx345</span><span class=o>.</span><span class=na>setConfigure</span><span class=o>();</span>
                            <span class=n>adx345</span><span class=o>.</span><span class=na>powerOn</span><span class=o>();</span>
                        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
                            <span class=c1>// ToDo</span>
                        <span class=o>}</span>
                    <span class=o>}</span>
                <span class=o>})</span>
                <span class=o>.</span><span class=na>build</span><span class=o>();</span>
    <span class=o>}</span>



<span class=o>}</span>
</pre></div></td></tr></table></p>
<p>BoardDefault.java</p>
<p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>package</span> <span class=nn>com.gclue.adx345</span><span class=o>;</span>

<span class=cm>/*</span>
<span class=cm> * Copyright 2016, The Android Open Source Project</span>
<span class=cm> *</span>
<span class=cm> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class=cm> * you may not use this file except in compliance with the License.</span>
<span class=cm> * You may obtain a copy of the License at</span>
<span class=cm> *</span>
<span class=cm> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<span class=cm> *</span>
<span class=cm> * Unless required by applicable law or agreed to in writing, software</span>
<span class=cm> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class=cm> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class=cm> * See the License for the specific language governing permissions and</span>
<span class=cm> * limitations under the License.</span>
<span class=cm> */</span>

<span class=kn>import</span> <span class=nn>android.os.Build</span><span class=o>;</span>

<span class=nd>@SuppressWarnings</span><span class=o>(</span><span class=s>&quot;WeakerAccess&quot;</span><span class=o>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BoardDefaults</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DEVICE_RPI3</span> <span class=o>=</span> <span class=s>&quot;rpi3&quot;</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DEVICE_IMX6UL_PICO</span> <span class=o>=</span> <span class=s>&quot;imx6ul_pico&quot;</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>DEVICE_IMX7D_PICO</span> <span class=o>=</span> <span class=s>&quot;imx7d_pico&quot;</span><span class=o>;</span>

    <span class=cm>/**</span>
<span class=cm>     * Return the preferred I2C port for each board.</span>
<span class=cm>     */</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>getI2CPort</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>switch</span> <span class=o>(</span><span class=n>Build</span><span class=o>.</span><span class=na>DEVICE</span><span class=o>)</span> <span class=o>{</span>
            <span class=k>case</span> <span class=n>DEVICE_RPI3</span><span class=o>:</span>
                <span class=k>return</span> <span class=s>&quot;I2C1&quot;</span><span class=o>;</span>
            <span class=k>case</span> <span class=n>DEVICE_IMX6UL_PICO</span><span class=o>:</span>
                <span class=k>return</span> <span class=s>&quot;I2C2&quot;</span><span class=o>;</span>
            <span class=k>case</span> <span class=n>DEVICE_IMX7D_PICO</span><span class=o>:</span>
                <span class=k>return</span> <span class=s>&quot;I2C1&quot;</span><span class=o>;</span>
            <span class=k>default</span><span class=o>:</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&quot;Unknown Build.DEVICE &quot;</span> <span class=o>+</span> <span class=n>Build</span><span class=o>.</span><span class=na>DEVICE</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></div></td></tr></table></p>
<p>MainActivity.java</p>
<p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kn>package</span> <span class=nn>com.gclue.adx345</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>android.app.Activity</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.content.Context</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.hardware.Sensor</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.hardware.SensorEvent</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.hardware.SensorEventListener</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.hardware.SensorManager</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.os.Bundle</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>android.util.Log</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=o>;</span>

<span class=cm>/**</span>
<span class=cm> * Skeleton of an Android Things activity.</span>
<span class=cm> * &lt;p&gt;</span>
<span class=cm> * Android Things peripheral APIs are accessible through the class</span>
<span class=cm> * PeripheralManagerService. For example, the snippet below will open a GPIO pin and</span>
<span class=cm> * set it to HIGH:</span>
<span class=cm> *</span>
<span class=cm> * &lt;pre&gt;{@code</span>
<span class=cm> * PeripheralManagerService service = new PeripheralManagerService();</span>
<span class=cm> * mLedGpio = service.openGpio(&quot;BCM6&quot;);</span>
<span class=cm> * mLedGpio.setDirection(Gpio.DIRECTION_OUT_INITIALLY_LOW);</span>
<span class=cm> * mLedGpio.setValue(true);</span>
<span class=cm> * }&lt;/pre&gt;</span>
<span class=cm> * &lt;p&gt;</span>
<span class=cm> * For more complex peripherals, look for an existing user-space driver, or implement one if none</span>
<span class=cm> * is available.</span>
<span class=cm> *</span>
<span class=cm> * @see &lt;a href=&quot;https://github.com/androidthings/contrib-drivers#readme&quot;&gt;https://github.com/androidthings/contrib-drivers#readme&lt;/a&gt;</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MainActivity</span> <span class=kd>extends</span> <span class=n>Activity</span> <span class=kd>implements</span> <span class=n>SensorEventListener</span> <span class=o>{</span>
    <span class=kd>private</span> <span class=n>Adx345AccelerometerDriver</span> <span class=n>mAdx345AccelerometerDriver</span><span class=o>;</span>
    <span class=kd>private</span> <span class=n>SensorManager</span> <span class=n>mSensorManager</span><span class=o>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>TAG</span> <span class=o>=</span> <span class=n>MainActivity</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>();</span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>onCreate</span><span class=o>(</span><span class=n>Bundle</span> <span class=n>savedInstanceState</span><span class=o>)</span> <span class=o>{</span>
        <span class=kd>super</span><span class=o>.</span><span class=na>onCreate</span><span class=o>(</span><span class=n>savedInstanceState</span><span class=o>);</span>
        <span class=n>setContentView</span><span class=o>(</span><span class=n>R</span><span class=o>.</span><span class=na>layout</span><span class=o>.</span><span class=na>activity_main</span><span class=o>);</span>

        <span class=n>mSensorManager</span> <span class=o>=</span> <span class=o>(</span><span class=n>SensorManager</span><span class=o>)</span> <span class=n>getSystemService</span><span class=o>(</span><span class=n>Context</span><span class=o>.</span><span class=na>SENSOR_SERVICE</span><span class=o>);</span>
        <span class=n>mSensorManager</span><span class=o>.</span><span class=na>registerDynamicSensorCallback</span><span class=o>(</span><span class=k>new</span> <span class=n>SensorManager</span><span class=o>.</span><span class=na>DynamicSensorCallback</span><span class=o>()</span> <span class=o>{</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onDynamicSensorConnected</span><span class=o>(</span><span class=n>Sensor</span> <span class=n>sensor</span><span class=o>)</span> <span class=o>{</span>
                <span class=k>if</span> <span class=o>(</span><span class=n>sensor</span><span class=o>.</span><span class=na>getType</span><span class=o>()</span> <span class=o>==</span> <span class=n>Sensor</span><span class=o>.</span><span class=na>TYPE_ACCELEROMETER</span><span class=o>)</span> <span class=o>{</span>
                    <span class=n>Log</span><span class=o>.</span><span class=na>i</span><span class=o>(</span><span class=n>TAG</span><span class=o>,</span> <span class=s>&quot;Accelerometer sensor connected&quot;</span><span class=o>);</span>
                    <span class=n>mSensorManager</span><span class=o>.</span><span class=na>registerListener</span><span class=o>(</span><span class=n>MainActivity</span><span class=o>.</span><span class=na>this</span><span class=o>,</span> <span class=n>sensor</span><span class=o>,</span>
                            <span class=n>SensorManager</span><span class=o>.</span><span class=na>SENSOR_DELAY_NORMAL</span><span class=o>);</span>
                <span class=o>}</span>
            <span class=o>}</span>
        <span class=o>});</span>
        <span class=k>try</span> <span class=o>{</span>
            <span class=n>mAdx345AccelerometerDriver</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Adx345AccelerometerDriver</span><span class=o>(</span><span class=n>BoardDefaults</span><span class=o>.</span><span class=na>getI2CPort</span><span class=o>());</span>
            <span class=n>mAdx345AccelerometerDriver</span><span class=o>.</span><span class=na>register</span><span class=o>();</span>
            <span class=n>Log</span><span class=o>.</span><span class=na>i</span><span class=o>(</span><span class=n>TAG</span><span class=o>,</span> <span class=s>&quot;Accelerometer driver registered&quot;</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>Log</span><span class=o>.</span><span class=na>e</span><span class=o>(</span><span class=n>TAG</span><span class=o>,</span> <span class=s>&quot;Error initializing accelerometer driver: &quot;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
        <span class=o>}</span>

    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onDestroy</span><span class=o>()</span> <span class=o>{</span>
        <span class=kd>super</span><span class=o>.</span><span class=na>onDestroy</span><span class=o>();</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>mAdx345AccelerometerDriver</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>mSensorManager</span><span class=o>.</span><span class=na>unregisterListener</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
            <span class=n>mAdx345AccelerometerDriver</span><span class=o>.</span><span class=na>unregister</span><span class=o>();</span>
            <span class=k>try</span> <span class=o>{</span>
                <span class=n>mAdx345AccelerometerDriver</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
                <span class=n>Log</span><span class=o>.</span><span class=na>e</span><span class=o>(</span><span class=n>TAG</span><span class=o>,</span> <span class=s>&quot;Error closing accelerometer driver: &quot;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
            <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
                <span class=n>mAdx345AccelerometerDriver</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>


    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onSensorChanged</span><span class=o>(</span><span class=n>SensorEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>Log</span><span class=o>.</span><span class=na>i</span><span class=o>(</span><span class=n>TAG</span><span class=o>,</span> <span class=s>&quot;Accelerometer event: &quot;</span> <span class=o>+</span>
                <span class=n>event</span><span class=o>.</span><span class=na>values</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span> <span class=o>+</span> <span class=n>event</span><span class=o>.</span><span class=na>values</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span> <span class=o>+</span> <span class=n>event</span><span class=o>.</span><span class=na>values</span><span class=o>[</span><span class=mi>2</span><span class=o>]);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onAccuracyChanged</span><span class=o>(</span><span class=n>Sensor</span> <span class=n>sensor</span><span class=o>,</span> <span class=kt>int</span> <span class=n>accuracy</span><span class=o>)</span> <span class=o>{</span>

    <span class=o>}</span>
<span class=o>}</span>
</pre></div></td></tr></table></p>
<p>AndroidManifest.xml</p>
<p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=cp>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class=nt>&lt;manifest</span> <span class=na>xmlns:android=</span><span class=s>&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class=na>package=</span><span class=s>&quot;com.gclue.adx345&quot;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;uses-permission</span> <span class=na>android:name=</span><span class=s>&quot;com.google.android.things.permission.MANAGE_SENSOR_DRIVERS&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;uses-permission</span> <span class=na>android:name=</span><span class=s>&quot;com.google.android.things.permission.USE_PERIPHERAL_IO&quot;</span> <span class=nt>/&gt;</span>

    <span class=nt>&lt;application</span> <span class=na>android:label=</span><span class=s>&quot;@string/app_name&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;uses-library</span> <span class=na>android:name=</span><span class=s>&quot;com.google.android.things&quot;</span> <span class=nt>/&gt;</span>

        <span class=nt>&lt;activity</span> <span class=na>android:name=</span><span class=s>&quot;.MainActivity&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;intent-filter&gt;</span>
                <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.MAIN&quot;</span> <span class=nt>/&gt;</span>

                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.LAUNCHER&quot;</span> <span class=nt>/&gt;</span>
            <span class=nt>&lt;/intent-filter&gt;</span>
        <span class=nt>&lt;/activity&gt;</span>
    <span class=nt>&lt;/application&gt;</span>

<span class=nt>&lt;/manifest&gt;</span>
</pre></div></td></tr></table></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../update/" title="Android Things Console" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前
                </span>
                Android Things Console
              </span>
            </div>
          </a>
        
        
          <a href="../webview01/" title="WebView表示" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  次
                </span>
                WebView表示
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.9e1f3b71.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../javascripts/extra.js"></script>
      
    
    
      
    
  </body>
</html>